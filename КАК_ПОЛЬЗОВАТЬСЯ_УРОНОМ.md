# 🎮 Как пользоваться системой урона через события

## ✅ Что уже сделано автоматически:

1. **EventHitComponent** - OneFrame компонент для передачи урона
2. **EnemyCollisionHandler** - MonoBehaviour, который автоматически добавляется на врагов при спавне
3. **PlayerHealthDamageSystem** - система обработки урона
4. **RuntimeData.PlayerEntity** - глобальная ссылка на entity игрока
5. Всё зарегистрировано в EcsStartup

## 📋 Настройка в Unity (пошагово):

### Шаг 1: Настройка префаба игрока
1. Открой префаб игрока в Unity
2. Убедись что у игрока есть:
   - **Tag = "Player"** (очень важно!)
   - **CharacterController** или **Collider** компонент
   - Если используешь Collider, можно сделать его Trigger или обычным (оба работают)

### Шаг 2: Настройка префаба врага
1. Открой префаб врага (который указан в EnemySpawnerSettings)
2. Добавь на врага **Collider** компонент:
   - Box Collider / Sphere Collider / Capsule Collider
   - **Обязательно поставь галочку "Is Trigger"**
3. **НЕ НУЖНО** вручную добавлять EnemyCollisionHandler - он добавится автоматически при спавне!

### Шаг 3: Настройка урона (опционально)
Если хочешь изменить урон для конкретного врага:
1. Спавни врага в игре (или создай тестового на сцене)
2. В Runtime в инспекторе врага появится компонент **EnemyCollisionHandler**
3. Измени поле **Damage** (по умолчанию 10)
4. Можно добавить EnemyCollisionHandler вручную на префаб и настроить там

### Шаг 4: Тестирование
1. Запусти игру (Play)
2. Враги будут спавниться через EnemySpawner
3. Враги будут преследовать игрока (EnemyChaseSystem)
4. При столкновении с врагом:
   - ✅ В консоли появится: `"Enemy hit player! Adding damage event: 10"`
   - ✅ В консоли появится: `"Player took 10 damage! Current health: 90/100"`
   - ✅ UI слайдер здоровья обновится
5. Каждое столкновение наносит урон

## 🔧 Как это работает технически:

```
1. EnemySpawnerSystem спавнит врага
   ↓
2. Автоматически добавляется EnemyCollisionHandler с RuntimeData
   ↓
3. Враг преследует игрока (EnemyChaseSystem)
   ↓
4. OnTriggerEnter сраба��ывает при столкновении
   ↓
5. EnemyCollisionHandler добавляет EventHitComponent на PlayerEntity
   ↓
6. PlayerHealthDamageSystem видит компонент и наносит урон
   ↓
7. Компонент EventHitComponent удаляется (.Del<> + .OneFrame<>)
   ↓
8. PlayerHealthUIUpdateSystem обновляет UI
```

## ⚙️ Настройка урона для разных типов врагов:

### Вариант 1: Вручную на префабе (рекомендуется)
```
1. Добавь EnemyCollisionHandler на префаб врага
2. Настрой Damage в инспекторе (например, 5 для слабых, 20 для сильных)
3. EnemySpawnerSystem найдёт существующий компонент и только инициализирует его
```

### Вариант 2: Через ScriptableObject настройки врага
Создай EnemySettings.cs:
```csharp
[CreateAssetMenu]
public class EnemySettings : ScriptableObject
{
    public GameObject EnemyPrefab;
    public float Damage = 10f;
    public float Speed = 3f;
}
```
И передавай урон при спавне.

## 🐛 Troubleshooting:

### "Урон не наносится"
- ✅ Проверь что у игрока есть **Tag = "Player"**
- ✅ Проверь что у врага есть **Collider с Is Trigger = true**
- ✅ Проверь консоль - должны быть логи "Enemy hit player!"

### "Враги не преследуют игрока"
- ✅ Проверь что EnemyChaseComponent добавляется в EnemySpawnerSystem
- ✅ Проверь что EnemyChaseSystem зарегистрирована в EcsStartup

### "Ошибка Cannot resolve symbol 'EventHitComponent'"
- ✅ Это кеш IDE, Unity всё равно скомпилирует правильно
- ✅ Попробуй: File → Invalidate Caches / Restart (в Rider/VS)
- ✅ Или просто запусти игру в Unity

## 📝 Дополнительные возможности:

### Добавить звук при уроне:
В `PlayerHealthDamageSystem.Run()` после отнятия здоровья:
```csharp
// Воспроизвести звук урона
AudioSource.PlayClipAtPoint(damageSound, player.PlayerTransform.position);
```

### Добавить эффект при уроне:
```csharp
// Создать визуальный эффект
Object.Instantiate(damageEffectPrefab, player.PlayerTransform.position, Quaternion.identity);
```

### Добавить неуязвимость после урона:
Создай компонент `InvulnerabilityComponent` с таймером и проверяй его в EnemyCollisionHandler.

## 🎯 Быстрый старт (1 минута):

1. Открой префаб игрока → поставь Tag "Player"
2. Открой префаб врага → добавь Box Collider, поставь Is Trigger = true
3. Запусти игру
4. Готово! Столкновения с врагами наносят урон

Всё работает автоматически благодаря ECS архитектуре! 🚀

